##########################################################################################################
##	
##	QueryFile.props
##
##	This is the query file from which queries of the following will be picked
##	* Interface Reconciliation Report
##	* 
##      Changes in this file should be done very carefully as any change in this file will have major
##	impact on the PreTUPS reports generated from these queries
##
###########################################################################################################This is query file use in process
##Interface Reconciliation Reports
#C2S Reconcilation Report Interface wise
#Return 3 number of column first display data,second is add in file name and third interface_id
query.process.reconcilationreport.c2s.interfacewise=SELECT (CT.network_code ||',' || CT.interface_id ||', '|| CT.interface_type ||', '||  CT.service_type ||', '|| L.selector_name ||', '||  CT.transfer_id ||', '||  CT.interface_reference_id ||', '|| CT.reference_id ||', '|| CT.interface_response_code ||', '|| INTR.external_id ||', '|| CT.sender_msisdn ||', '||  CT.receiver_msisdn ||', '|| NVL(KV.value,CT.transfer_status) ||', '|| CT.card_group_code ||', '|| TO_CHAR(CT.transfer_date, ?) ||', '||  TO_CHAR(CT.transfer_date_time, ?) ||', '||  CT.receiver_bonus_validity ||', RBV='|| CT.receiver_bonus_value  ||', '||  CT.receiver_grace_period ||', RV='|| CT.quantity ||', TV='||  CT.transfer_value) details, INTR.external_id, CT.interface_id FROM c2s_transfers CT, key_values KV, interfaces INTR, service_type_selector_mapping L WHERE  INTR.interface_id=CT.interface_id  AND CT.transfer_status !=? AND L.selector_code=CT.sub_service AND L.service_type=CT.service_type AND KV.type(+)=? AND KV.key(+)=CT.transfer_status AND CT.transfer_date_time>? AND CT.transfer_date_time<=? ORDER BY CT.interface_id, CT.transfer_date_time DESC

#P2P Reconcilation Report Interface wise
#Return 3 number of column first display data, second is add in file name and third interface_id
query.process.reconcilationreport.p2p.interfacewise=SELECT (ST.network_code ||', '|| TI.interface_id ||', '|| TI.interface_type ||', '|| ST.service_type ||', '|| L.selector_name ||', '|| ST.transfer_category ||', '|| TI.transfer_id ||', '|| TI.interface_reference_id ||', '|| TI.reference_id ||', '|| TI.interface_response_code ||', '|| INTR.external_id ||', '|| TI.msisdn ||', '|| TI.user_type ||', '|| NVL(KV.value, ST.transfer_status) ||', '|| ST.card_group_code ||', '|| TO_CHAR(TI.transfer_date, ?) ||', '|| TO_CHAR(TI.transfer_date_time, ?) ||', '|| TI.entry_type ||', '|| ST.receiver_bonus_validity ||', RBV='|| ST.receiver_bonus_value ||', '|| ST.receiver_grace_period ||', RV='|| TI.request_value ||', TV='|| TI.transfer_value) details, INTR.external_id, TI.interface_id FROM subscriber_transfers ST, transfer_items TI,key_values KV, interfaces INTR, service_type_selector_mapping  L WHERE TI.transfer_id=ST.transfer_id AND INTR.interface_id=TI.interface_id AND ST.transfer_status !=? AND KV.type(+)=? AND KV.key(+)=ST.transfer_status AND L.selector_code=ST.sub_service AND L.service_type=ST.service_type AND  ST.transfer_date_time>? AND ST.transfer_date_time<=? ORDER BY TI.interface_id, ST.transfer_date_time DESC

#P2P Reconcilation Report Service wise
#Return 3 number of column  first display data, second is add in file name and third interface_id
query.process.reconcilationreport.p2p.servicewise=SELECT (ST.network_code ||', '|| TI.interface_id ||', '|| TI.interface_type ||', '|| ST.service_type ||', '|| L.selector_name ||', '|| ST.transfer_category ||', '|| TI.transfer_id ||', '|| TI.interface_reference_id ||', '|| TI.reference_id ||', '|| TI.interface_response_code ||', '|| INTR.external_id ||', '|| TI.msisdn ||', '|| TI.user_type ||', '|| NVL(KV.value, ST.transfer_status) ||', '|| ST.card_group_code ||', '|| TO_CHAR(TI.transfer_date, ?) ||', '|| TO_CHAR(TI.transfer_date_time, ?) ||', '|| TI.entry_type ||', '|| ST.receiver_bonus_validity ||', RBV='|| ST.receiver_bonus_value ||', '|| ST.receiver_grace_period ||', RV='|| TI.request_value ||', TV='|| TI.transfer_value) details, ST.service_type, TI.interface_id FROM subscriber_transfers ST, transfer_items TI,key_values KV, interfaces INTR, service_type_selector_mapping  L WHERE TI.transfer_id=ST.transfer_id AND INTR.interface_id=TI.interface_id AND ST.transfer_status !=? AND KV.type(+)=? AND KV.key(+)=ST.transfer_status AND L.selector_code=ST.sub_service AND L.service_type=ST.service_type  AND  ST.transfer_date_time>? AND ST.transfer_date_time<=? ORDER BY ST.service_type, TI.interface_id, ST.transfer_date_time DESC

## DWH files queries
# RP2P DWH files

# CP2P DWH files


#IMA File query
#EXTERNAL_FILE_QUERY= SELECT (CT.transfer_id||','||CT.sender_id||',' || REPLACE(U.user_name,',',' ')||',' || UP.msisdn||',' || C.category_code||',' ||C.domain_code||',' ||  U.external_code||',' ||U.owner_id||',' || OU.user_name||',' || OU.external_code||',' || U.parent_id ||',' || NVL(PU.user_name,U.user_name)||',' ||PU.employee_code||',' ||CT.source_type||',' || CT.receiver_msisdn||',' || CT.transfer_value||',' || CT.sender_transfer_value||',' || CT.receiver_transfer_value||',' || CTI.interface_id||',' ||CT.service_type||',' || CT.sub_service||',' || CTI.service_class_id||',' || SC.service_class_name||',' ||to_char(CT.transfer_date,?)||',' ||to_char(CT.transfer_date_time,?)) details FROM c2s_transfers CT,c2s_transfer_items CTI,users U,users OU, users PU,categories C,service_classes SC, user_phones UP WHERE CT.transfer_id=CTI.transfer_id AND CTI.sno=2 AND CT.sender_id=U.user_id AND U.user_id=UP.user_id AND UP.primary_number='Y' AND U.category_code=C.category_code AND U.owner_id=OU.user_id AND U.parent_id = PU.user_id(+) AND CTI.service_class_id=SC.service_class_id(+) AND CT.transfer_status='200' AND CT.transfer_date_time>? AND CT.transfer_date_time<=? 
### Below is the External File for Mobinil specific
EXTERNAL_FILE_QUERY= SELECT (CT.transfer_id||','||CT.sender_id||',' || REPLACE(U.user_name,',',' ')||',' || UP.msisdn||',' || C.category_code||',' ||C.domain_code||',' ||  U.external_code||',' ||U.owner_id||',' || OU.user_name||',' || OU.external_code||',' || U.parent_id ||',' || NVL(PU.user_name,U.user_name)||',' ||PU.employee_code||',' ||CT.source_type||',' || CT.receiver_msisdn||',' || CT.transfer_value||',' || CT.sender_transfer_value||',' || CT.receiver_transfer_value||',' || CTI.interface_id||',' ||CT.SERVICE_TYPE||',' || CT.sub_service||',' || CTI.service_class_id||',' || SC.service_class_name||',' ||TO_CHAR(CT.transfer_date,'dd/MM/yy')||',' ||TO_CHAR(CT.transfer_date_time,'dd/MM/yy HH24:MI:SS')) ||',' ||CTI.previous_balance ||',' ||(CTI.previous_balance-CT.sender_transfer_value) details FROM C2S_TRANSFERS CT,C2S_TRANSFER_ITEMS CTI,USERS U,USERS OU, USERS PU,CATEGORIES C,SERVICE_CLASSES SC, USER_PHONES UP WHERE CT.transfer_id=CTI.transfer_id AND CTI.sno=1 AND U.user_id=? AND CT.sender_id=U.user_id AND U.user_id=UP.user_id AND UP.primary_number='Y' AND U.category_code=C.category_code AND U.owner_id=OU.user_id AND U.parent_id = PU.user_id(+) AND CTI.service_class_id=SC.service_class_id(+) AND CT.transfer_status='200' AND CT.transfer_date_time>? AND CT.transfer_date_time<=?


#O2C transaction data file Through External System
O2CEXT_TRANSACTION_QUERY=SELECT nvl(U1.user_name,'OPT')||','||nvl(U2.user_name,'OPT')||','||CT.transfer_id||','||CT.transfer_category||','||CT.transfer_sub_type||','||to_char(CTI.transfer_date,'dd/mm/yyyy hh24:mi:ss PM')||','||CTI.product_code||','||CT.ext_txn_no||','||CT.request_gateway_code||','||CT.type||','||to_char(CT.ext_txn_date,'dd/mm/yyyy')||','||CT.requested_quantity/100||','||CTI.tax1_type||','||CTI.tax1_value||','||CTI.tax2_type||','||CTI.tax2_value||','||CTI.payable_amount/100||','||CTI.net_payable_amount/100 From channel_transfers CT,channel_transfers_items CTI, Users U1, Users U2 Where trunc(CT.close_date)=? AND CT.request_gateway_type='EXTGW' AND CT.transfer_id=CTI.transfer_id  AND U1.user_id(+)=CT.from_user_id AND U2.user_id(+)=CT.to_user_id AND CT.status='CLOSE' Order by CT.request_gateway_code,CT.type

USER_BALANCE_REPORT_QUERY_ALL=SELECT REPLACE(u.user_name,',',' ')||','||u.msisdn||','||c.category_name||','||gd1.GRPH_DOMAIN_NAME||','||up.user_name||','||up.MSISDN||','||gd2.GRPH_DOMAIN_NAME ||','||gp.USER_NAME ||','|| gp.MSISDN||','||gd3.GRPH_DOMAIN_NAME ||','||gd4.GRPH_DOMAIN_NAME||','||(ub.BALANCE/100) FROM USERS u, USERS up,USERS gp,USERS ou,CATEGORIES c,USER_GEOGRAPHIES ug1, USER_GEOGRAPHIES ug2,USER_GEOGRAPHIES ug3,USER_GEOGRAPHIES ug4,USER_BALANCES ub, GEOGRAPHICAL_DOMAINS gd1,GEOGRAPHICAL_DOMAINS gd2,GEOGRAPHICAL_DOMAINS gd3,GEOGRAPHICAL_DOMAINS gd4 WHERE up.USER_ID=CASE u.parent_id WHEN 'ROOT' THEN u.user_id ELSE u.parent_id END AND gp.USER_ID=CASE up.PARENT_ID WHEN 'ROOT' THEN up.user_id ELSE up.parent_id END AND ou.USER_ID=u.OWNER_ID AND ug1.USER_ID=u.USER_ID AND ug1.GRPH_DOMAIN_CODE=gd1.GRPH_DOMAIN_CODE AND ug2.USER_ID=up.USER_ID AND ug2.GRPH_DOMAIN_CODE=gd2.GRPH_DOMAIN_CODE AND gp.USER_ID=ug3.USER_ID AND ug3.GRPH_DOMAIN_CODE=gd3.GRPH_DOMAIN_CODE AND ug4.USER_ID=ou.USER_ID AND ug4.GRPH_DOMAIN_CODE=gd4.GRPH_DOMAIN_CODE AND u.user_id=ub.USER_ID AND u.user_id=ub.user_id AND u.user_id=ug1.USER_ID AND u.category_code=c.category_code AND u.status <> 'N' AND u.STATUS<>'C' ORDER BY c.category_name,u.USER_NAME
USER_BALANCE_REPORT_QUERY_MULTIPLE=SELECT REPLACE(u.user_name,',',' ')||','||u.msisdn||','||c.category_name||','||gd1.GRPH_DOMAIN_NAME||','||up.user_name||','||up.MSISDN||','||gd2.GRPH_DOMAIN_NAME ||','||gp.USER_NAME ||','|| gp.MSISDN||','||gd3.GRPH_DOMAIN_NAME ||','||gd4.GRPH_DOMAIN_NAME||','||(ub.BALANCE/100) FROM USERS u, USERS up,USERS gp,USERS ou,CATEGORIES c,USER_GEOGRAPHIES ug1, USER_GEOGRAPHIES ug2,USER_GEOGRAPHIES ug3,USER_GEOGRAPHIES ug4,USER_BALANCES ub, GEOGRAPHICAL_DOMAINS gd1,GEOGRAPHICAL_DOMAINS gd2,GEOGRAPHICAL_DOMAINS gd3,GEOGRAPHICAL_DOMAINS gd4 WHERE up.USER_ID=CASE u.parent_id WHEN 'ROOT' THEN u.user_id ELSE u.parent_id END AND gp.USER_ID=CASE up.PARENT_ID WHEN 'ROOT' THEN up.user_id ELSE up.parent_id END AND ou.USER_ID=u.OWNER_ID AND ug1.USER_ID=u.USER_ID AND ug1.GRPH_DOMAIN_CODE=gd1.GRPH_DOMAIN_CODE AND ug2.USER_ID=up.USER_ID AND ug2.GRPH_DOMAIN_CODE=gd2.GRPH_DOMAIN_CODE AND gp.USER_ID=ug3.USER_ID AND ug3.GRPH_DOMAIN_CODE=gd3.GRPH_DOMAIN_CODE AND ug4.USER_ID=ou.USER_ID AND ug4.GRPH_DOMAIN_CODE=gd4.GRPH_DOMAIN_CODE AND u.user_id=ub.USER_ID AND u.category_code=c.category_code AND u.category_code IN (REPLACE_DATA) AND u.status <> 'N' AND u.STATUS<>'C' ORDER BY c.category_name,u.USER_NAME